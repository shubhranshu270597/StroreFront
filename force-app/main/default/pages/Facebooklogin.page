<!--
  @description       : 
  @author            : shubhranshu
  @group             : 
  @last modified on  : 12-06-2020
  @last modified by  : shubhranshu
  Modifications Log 
  Ver   Date         Author        Modification
  1.0   12-05-2020   shubhranshu   Initial Version
-->
<apex:page showHeader="false" standardStylesheets="false" controller="InstamojoPurchaseProductController">

    <head>
        <title>Facebook Login JavaScript Example</title>
        <meta charset="UTF-8" />
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    </head>
    <style> 
              /* Shared */
        .loginBtn {
          box-sizing: border-box;
          position: relative;
          /* width: 13em;  - apply for fixed size */
          margin: 0.2em;
          padding: 0 15px 0 46px;
          border: none;
          text-align: left;
          line-height: 34px;
          white-space: nowrap;
          border-radius: 0.2em;
          font-size: 16px;
          color: #FFF;
        }
        .loginBtn:before {
          content: "";
          box-sizing: border-box;
          position: absolute;
          top: 0;
          left: 0;
          width: 34px;
          height: 100%;
        }
        .loginBtn:focus {
          outline: none;
        }
        .loginBtn:active {
          box-shadow: inset 0 0 0 32px rgba(0,0,0,0.1);
        }
                    /* Facebook */
      .loginBtn--facebook {
        background-color: #4C69BA;
        background-image: linear-gradient(#4C69BA, #3B55A0);
        /*font-family: "Helvetica neue", Helvetica Neue, Helvetica, Arial, sans-serif;*/
        text-shadow: 0 -1px 0 #354C8C;
      }
      .loginBtn--facebook:before {
        border-right: #364e92 1px solid;
        background: url('https://s3-us-west-2.amazonaws.com/s.cdpn.io/14082/icon_facebook.png') 6px 6px no-repeat;
      }
      .loginBtn--facebook:hover,
      .loginBtn--facebook:focus {
        background-color: #5B7BD5;
        background-image: linear-gradient(#5B7BD5, #4864B1);
      }
      
    </style>
    <body>
      <div id="fb-root"></div>
      <script>
        // var j$ = jQuery.noConflict();
        window.fbAsyncInit = function() {
          // init the FB JS SDK
          FB.init({
            appId      : '184246996697884', // App ID from the App Dashboard
            channelUrl : '/resource/alljs', // Channel File for x-domain communication--- added the sdk in static resource.
            status     : true, // check the login status upon init?
            cookie     : true, // set sessions cookies to allow your server to access the session?
            xfbml      : true  // parse XFBML tags on this page?
            // version    : 'v9.0'
          });
          // FB.AppEvents.logPageView();
       // Additional initialization code such as adding Event Listeners goes here
       };
       
       // Load the SDK's source Asynchronously
       // Note that the debug version is being actively developed and might 
       // contain some type checks that are overly strict. 
       // Please report such bugs using the bugs tool.
       (function(d, debug){
          var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
          if (d.getElementById(id)) {return;}
          js = d.createElement('script'); js.id = id; js.async = true;
          js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
          ref.parentNode.insertBefore(js, ref);
          }(document, /*debug*/ false));
          $(document).ready(function(){
              $("#loginButton").click(function(){
              FB.login(function(response) {
              if (response.authResponse) {
                  console.log('Welcome!  Fetching your information.... ');
                  // FB.api('/me', function(response) {
                  // console.log('Good to see you, ' + response.name+ '.'+response.email);
                  // console.log('response '+JSON.stringify(response));
                  // });
                  var infoFields = "id,about,age_range,picture,birthday,email,first_name,gender,hometown,link,location,middle_name,last_name,name,timezone,website,work";
                  FB.api('/me', {fields: infoFields}, function(response) {
                    console.log(response);
                    
                    var firstname = response.first_name;
                    var lastname = response.last_name;
                    var mail = response.email;
                    var dateofbirth=response.birthday;
                    // $("#name").append(response.name);
                    // $("#fb-profile-picture").append('<img src="' + response.picture.data.url + '" /> ');
                    // document.getElementById('{!$Component.formid.blockid.sectionid.fname}').value = firstname;
                    // document.getElementById('{!$Component.formid.blockid.sectionid.lname}').value = lastname;
                    // document.getElementById('{!$Component.formid.blockid.sectionid.uemail}').value = mail;
                    // document.getElementById('{!$Component.formid.blockid.sectionid.dob}').value = dateofbirth; });
                    // $('[id$=fname]').val(firstname);
                    $('[id$=firstname]').val(firstname);
                    $('[id$=lastname]').val(lastname);
                    $('[id$=useremail]').val(mail);
                    // $('[id$=dob]').val(dateofbirth);
                    
                    saveDetails();
                  });
              } else {
                  console.log('User cancelled login or did not fully authorize.');
              }
              });
          });
        });
      </script>
      <!-- <input type="button" id="loginButton" data-scope="public_profile,email" value="login to FB"></input> -->
      <button id="loginButton" data-scope="public_profile,email"  class="loginBtn loginBtn--facebook">
        Login with Facebook
      </button>
      <apex:form id="formid">
        <apex:actionFunction name="saveDetails" action="{!saveCNXStoreFrontUser}" />
        <apex:inputHidden  id="firstname" value="{!fname}" />
        <apex:inputHidden id="lastname" value="{!lname}" />
        <apex:inputHidden  id="useremail" value="{!uemail}" />
      </apex:form>
    </body>
</apex:page>